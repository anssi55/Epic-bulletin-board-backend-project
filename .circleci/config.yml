# Use the latest 2.1 version of CircleCI pipeline processing engine, see https://circleci.com/docs/2.0/configuration-reference/
version: 2.1

# Use a package of configuration called an orb, see https://circleci.com/docs/2.0/orb-intro/
orbs:
  # Declare a dependency on the welcome-orb
  welcome: circleci/welcome-orb@0.3.1

# Orchestrate or schedule a set of jobs, see https://circleci.com/docs/2.0/workflows/
workflows:
  # Name the workflow "Welcome"
  Welcome:
    # Run the welcome/run job in its own container
    jobs:
      - welcome/run
steps:
  run: bash .circleci/setup-heroku.sh
  add_ssh_keys:
      fingerprints:
        - $HEROKU_SSH_FINGERPRINT
  deploy:
    name: Deploy to Heroku if tests pass and branch is master
    command: |
      if [ "${CIRCLE_BRANCH}" == "master" ]; then
        git push --force git@heroku.com:$HEROKU_APP_NAME.git HEAD:refs/heads/master
        <any other necessary commands for heroku deployment you might need can go here>
      fi
    